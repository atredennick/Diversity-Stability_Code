r.mu=(rbig[js]+rbig[ks])/2
matplot(Kyq$r,cbind(Obs.big,Obs.small),
type="l",lty=c("solid","solid"),pch=c(1,16),xlab="",ylab="",
col=c("blue","red"),lwd=2);
title(main=paste(snames[js],":",snames[ks],sep=" "));
abline(v=2*r.mu,col="black",lty=1,lwd=1);
if(js==1 & ks==1) {legend("topleft",legend=c("Obs. small","Obs. big"),
lty=c("solid","solid"),lwd=2,col=c("black""red"),bty="o",box.col="black",bg="white")}
r.mu=(rbig[js]+rbig[ks])/2
matplot(Kyq$r,cbind(Obs.big,Obs.small),
type="l",lty=c("solid","solid"),pch=c(1,16),xlab="",ylab="",
col=c("blue","red"),lwd=2);
cbind(Obs.big,Obs.small)
matplot(Kyq$r,cbind(Obs.big,Obs.small))
Kyq$r
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
js=1
ks=1
print(paste(js,ks,sep=" "))
flush.console()
# parameters for K function
ppregion(0,100,0,100)
fs=50; k=20
### Pairwise distances between big plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area>cbig[js])
years=unique(Xb$year); nyears=length(years)
Kvals=numeric(k); xvals=Kvals
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.big=Kvals[,-1]; Kvals.big=apply(Kvals.big,1,mean);
Kyq
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area<csmall[js]);
years=unique(Xb$year); nyears=length(years);
Kvals=numeric(k);  xvals=Kvals;
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.small=Kvals[,-1]; Kvals.small=apply(Kvals.small,1,mean);
Obs.big=Kvals.big ; Obs.small=Kvals.small;
Kyq
Kyq
xvals
xvals
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
js=1
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
ks=1
js=1
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
#tiff("K_all.tif",units="in",height=10,width=9,res=300)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
js=1
ks=1
if(js==ks){
# conspecific comparison *****************************************************
print(paste(js,ks,sep=" "))
flush.console()
# parameters for K function
ppregion(0,100,0,100)
fs=50; k=20
### Pairwise distances between big plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area>cbig[js])
years=unique(Xb$year); nyears=length(years)
Kvals=numeric(k); xvals=Kvals
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.big=Kvals[,-1]; Kvals.big=apply(Kvals.big,1,mean);
### Pairwise distances between small plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area<csmall[js]);
years=unique(Xb$year); nyears=length(years);
Kvals=numeric(k);  xvals=Kvals;
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.small=Kvals[,-1]; Kvals.small=apply(Kvals.small,1,mean);
Obs.big=Kvals.big ; Obs.small=Kvals.small;
Kyq
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
#tiff("K_all.tif",units="in",height=10,width=9,res=300)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
js=1
ks=1
print(paste(js,ks,sep=" "))
flush.console()
# parameters for K function
ppregion(0,100,0,100)
fs=50; k=20
### Pairwise distances between big plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area>cbig[js])
years=unique(Xb$year); nyears=length(years)
Kvals=numeric(k); xvals=Kvals
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.big=Kvals[,-1]; Kvals.big=apply(Kvals.big,1,mean);
### Pairwise distances between small plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area<csmall[js]);
years=unique(Xb$year); nyears=length(years);
Kvals=numeric(k);  xvals=Kvals;
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.small=Kvals[,-1]; Kvals.small=apply(Kvals.small,1,mean);
Obs.big=Kvals.big ; Obs.small=Kvals.small;
Kyq
class(Kyq)
ks=2
print(paste(js,ks,sep=" "))
flush.console()
# observed data ============================================================
X=subset(obsX,species==snames[js] | species==snames[ks])
X$marks=as.factor(X$species)
## parameters for K function
r=seq(0,40,1)
### Pairwise distances between big plants
### for all year/quadrat combinations
tmp1=which(X$species==snames[js] & X$area>cbig[js])
tmp2=which(X$species==snames[ks] & X$area>cbig[ks])
Xb=X[c(tmp1,tmp2),]
years=unique(Xb$year); nyears=length(years)
Kvals=numeric(length(r)); xvals=Kvals
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
if(sum(Xjk$species==snames[js])>0 & sum(Xjk$species==snames[ks])>0){
Xppp=ppp(x=Xjk$x,y=Xjk$y,marks=Xjk$marks, window=owin(c(0,100),c(0,100)))
Kyq=Kcross(Xppp,snames[js],snames[ks],r=r)
Lyq=sqrt(Kyq$iso/pi) # scale same as Kfn in package spatial
Kvals=cbind(Kvals,Lyq);
xvals=cbind(xvals,Kyq$r);
} # end if
}
}
Kvals.big=Kvals[,-1]; Kvals.big=apply(Kvals.big,1,mean);
### Pairwise distances between small plants
### for all year/quadrat combinations
tmp1=which(X$species==snames[js] & X$area<csmall[js])
tmp2=which(X$species==snames[ks] & X$area<csmall[ks])
Xb=X[c(tmp1,tmp2),]
years=unique(Xb$year); nyears=length(years)
Kvals=numeric(length(r)); xvals=Kvals
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
if(sum(Xjk$species==snames[js])>0 & sum(Xjk$species==snames[ks])>0){
Xppp=ppp(x=Xjk$x,y=Xjk$y,marks=Xjk$marks, window=owin(c(0,100),c(0,100)))
Kyq=Kcross(Xppp,snames[js],snames[ks],r=r)
Lyq=sqrt(Kyq$iso/pi) # scale same as Kfn in package spatial
Kvals=cbind(Kvals,Lyq);
xvals=cbind(xvals,Kyq$r);
} # end if
}
}
Kvals.small=Kvals[,-1]; Kvals.small=apply(Kvals.small,1,mean);
Obs.big=Kvals.big ; Obs.small=Kvals.small;
}  # end if js==ks
Kyq$r
r
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
#tiff("K_all.tif",units="in",height=10,width=9,res=300)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
r=seq(0,40,1)
ks
ks=1
js
js=1
if(js==ks){
# conspecific comparison *****************************************************
print(paste(js,ks,sep=" "))
flush.console()
# parameters for K function
ppregion(0,100,0,100)
fs=50; k=20
### Pairwise distances between big plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area>cbig[js])
years=unique(Xb$year); nyears=length(years)
Kvals=numeric(k); xvals=Kvals
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.big=Kvals[,-1]; Kvals.big=apply(Kvals.big,1,mean);
### Pairwise distances between small plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area<csmall[js]);
years=unique(Xb$year); nyears=length(years);
Kvals=numeric(k);  xvals=Kvals;
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.small=Kvals[,-1]; Kvals.small=apply(Kvals.small,1,mean);
Obs.big=Kvals.big ; Obs.small=Kvals.small;
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
#tiff("K_all.tif",units="in",height=10,width=9,res=300)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
r=seq(0,40,1)
setwd('Z:/aldoc/RESEARCH/Rare Species/Climate_model/Spatial patterns')
snames=c("ARTR","HECO","POSE","PSSP");
library(spatial)
library(spatstat)
#tiff("K_all.tif",units="in",height=10,width=9,res=300)
par(mfrow=c(Nspp,Nspp),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,3,3,1),oma=c(2,2,0,0));
recruit.size=cbig=csmall=rbig=rsmall=numeric(Nspp)
for(js in 1:Nspp) {
## observed  data ====================================================
sname=snames[js]
setwd(paste("h:\\idahochart\\ipm\\speciesData\\",sname,sep=""))
X=read.csv(paste(sname,"_genet_xy.csv",sep=""))
X$species=snames[js]
z=table(factor(X$area))
jj=which(z==max(z))
recruit.size[js]=as.numeric(names(jj)); cat(sname,recruit.size[js],"\n")
tmpX = X[X$area>1.01*recruit.size[js],]  #remove recruit-size plants
cbig[js]=quantile(tmpX$area,0.67) # define 'big'
csmall[js]=quantile(tmpX$area,0.33) # define 'small'
rm(tmpX)
Abig=X$area[X$area>=cbig[js]]
rbig[js]=mean(sqrt(Abig/pi))
Asmall=X$area[X$area<csmall[js]]
rsmall[js]=mean(sqrt(Asmall/pi))
if(js==1) obsX=X else obsX=rbind(obsX,X)
} # next js
rm(X)
r=seq(0,40,1)
js
js=1
ks
# conspecific comparison *****************************************************
print(paste(js,ks,sep=" "))
flush.console()
# parameters for K function
ppregion(0,100,0,100)
fs=50; k=20
### Pairwise distances between big plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area>cbig[js])
years=unique(Xb$year); nyears=length(years)
Kvals=numeric(k); xvals=Kvals
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.big=Kvals[,-1]; Kvals.big=apply(Kvals.big,1,mean);
### Pairwise distances between small plants
### for all year/quadrat combinations
Xb=subset(obsX,species==snames[js] & area<csmall[js]);
years=unique(Xb$year); nyears=length(years);
Kvals=numeric(k);  xvals=Kvals;
for(j in 1:nyears) {
Xj=subset(Xb,year==years[j]);
Q=unique(Xj$quad); nquad=length(Q);
for(kk in 1:nquad) {
Xjk=subset(Xj,quad==Q[kk]);
Kyq=Kfn(Xjk,fs,k);
Kvals=cbind(Kvals,Kyq$y);
xvals=cbind(xvals,Kyq$x);
}
}
Kvals.small=Kvals[,-1]; Kvals.small=apply(Kvals.small,1,mean);
Obs.big=Kvals.big ; Obs.small=Kvals.small;
r.mu=(rbig[js]+rbig[ks])/2
matplot(r,cbind(Obs.big,Obs.small),
type="l",lty=c("solid","solid"),pch=c(1,16),xlab="",ylab="",
col=c("blue","red"),lwd=2);
Obs.big
